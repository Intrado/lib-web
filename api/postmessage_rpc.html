<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-type" content="text/html; charset=UTF-8" />
	<title>postMessage RPC interface</title>

	<script type="text/javascript" src="../script/jquery.1.7.2.min.js"></script>
	<script type="text/javascript" src="../script/jquery.json-2.3.min.js"></script>
	<script type="text/javascript" src="../script/postmessagehandler.js"></script>
	<script type="text/javascript" src="../script/commsuite_api.js"></script>
	<script type="text/javascript">
		(function($){
			// discover the base url and customer
			var pathArray = window.location.toString().split( '/' );
			var host = pathArray[2];
			var customer = pathArray[3];

			var postMessageHandler = new PostMessageHandler(top);
			postMessageHandler.attachListener(function(event) {
				console.log("postmessage_rpc.html Got message: " + event.data + " from origin: " + event.origin);

				var data = $.secureEvalJSON(event.data);

				var resp = {};
				switch (data.type) {
					case "list":

					default:
						resp["status"] = "error";
						resp["error"] = "unknowntype";
				}
			});

			// initialize the api
			var csApi = new CommSuiteApi(host, customer);
			csApi.init(function(data, status, headers) {
				if (status == 200) {
					postMessageHandler.postMessageAll({
						"status": "ready"
					});
				} else {
					postMessageHandler.postMessageAll({
						"status": "error",
						"error" : data.error
					});
				}
			});

		})(jQuery);
	</script>
</head>
<body><!-- No body... --></body>
</html>