// tip.min.js
// version: 1.0
// Date: 12-3-2013
var QuickTip=function(){var e=window.document,t=e.getElementById("quicktip"),n=e.getElementById("mask"),r=e.getElementById("orgId"),i=e.getElementById("topicId"),s=e.getElementById("message"),o=e.getElementById("tip-message-control-group"),u=e.getElementById("tip-error-message"),a=e.getElementById("email"),f=e.getElementById("phone"),l=e.getElementById("tip-submit"),c=e.getElementById("submitting-tip-span"),h=e.getElementById("submit-tip-span"),p=null,d=null,v="",m="",g=false,y=true,b=true,w;var E=function(){if(window.addEventListener){return function(e,t,n){e.addEventListener(t,n,false)}}else if(window.attachEvent){return function(e,t,n){e.attachEvent("on"+t,n)}}else{return function(e,t,n){e["on"+t]=n}}}();w={submitFormHandler:function(e){w.setSelectedOrgId();w.setSelectedTopicId();w.isTipValid();w.isEmailValid();w.isPhoneValid();if(!g||!y||!b){e.preventDefault();w.renderValidation()}else{w.setFormActionURL();w.removeClass(n,"hide");w.removeClass(c,"hide");w.addClass(h,"hide");t.submit()}},messageTextHandler:function(e){if(!g){w.isTipValid();if(w.isMessageTextValid()){w.renderValidation()}}},emailHandler:function(e){if(!g){w.isTipValid();if(w.isEmailValid()){w.renderValidation()}}},phoneHandler:function(e){if(!g){w.isTipValid();if(w.isPhoneValid()){w.renderValidation()}}},removeEventHandlers:function(){l.removeEventListener("click",w.submitHandler,false);s.removeEventListener("keyup",w.messageTextHandler,false);a.removeEventListener("keyup",w.emailHandler,false);f.removeEventListener("keyup",w.phoneHandler,false)},setErrorMessage:function(e){u.innerHTML+=e+"<br>";this.removeClass(u,"hide")},isMessageTextValid:function(){return s.value.replace(/^\s+|\s+$/g,"").length>0?true:false},isSelectedIdValid:function(e){return typeof e!=="undefined"&&e>-1?true:false},isTipValid:function(){return g=this.isMessageTextValid()&&this.isSelectedIdValid(this.orgId)&&this.isSelectedIdValid(this.topicId)&&this.isEmailValid()&&this.isPhoneValid()},isEmailValid:function(){return y=typeof a.checkValidity==="function"?a.checkValidity():true},isPhoneValid:function(){return b=typeof f.checkValidity==="function"?f.checkValidity():true},renderValidation:function(){u.innerHTML="";if(g){this.addClass(u,"hide");this.removeClass(o,"has-error")}else{if(!this.isSelectedIdValid(this.orgId)){this.setErrorMessage("Please select a valid Organization.")}if(!this.isSelectedIdValid(this.topicId)){this.setErrorMessage("Please select a valid Topic.")}if(!this.isMessageTextValid()){this.addClass(o,"has-error");this.setErrorMessage("Please enter a Tip Message.")}else if(this.isMessageTextValid()){this.removeClass(o,"has-error")}if(!y){this.setErrorMessage('Please enter a valid email address.<div class="error-format-example">Ex. janedoe@example.com</div>')}if(!b){this.setErrorMessage('Please enter a valid phone number.<div class="error-format-example">Format: (888) 555-1234, 888-555-1234, or 888.555.1234</div>')}this.removeClass(u,"hide")}},setFormActionURL:function(){this.formActionUrl="/api/2/organizations/"+this.orgId+"/topics/"+this.topicId+"/quicktip";this.baseCustomerURL=t.getAttribute("data-base-url");t.setAttribute("action",this.baseCustomerURL+this.formActionUrl)},setSelectedOrgId:function(){this.orgId=r.selectedIndex>-1?r.options[r.selectedIndex].value:-1},setSelectedTopicId:function(){this.topicId=i.selectedIndex>-1?i.options[i.selectedIndex].value:-1},hasClass:function(e,t){return(new RegExp(" "+t)).test(" "+e.className)},addClass:function(e,t){if(!this.hasClass(e,t)){e.className+=" "+t}},removeClass:function(e,t){var n=" "+e.className.replace(/[\t\r\n]/g," ")+" ";if(this.hasClass(e.className)){while(n.indexOf(" "+t+" ")>=0){n=n.replace(" "+t+" "," ")}e.className=n.replace(/^\s+|\s+$/g,"")}}};E(l,"click",w.submitFormHandler);E(s,"keyup",w.messageTextHandler);E(a,"keyup",w.emailHandler);E(f,"keyup",w.phoneHandler);w.setSelectedOrgId();w.setSelectedTopicId();return w}